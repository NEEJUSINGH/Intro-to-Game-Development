<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Space Invader Mini Game</title>
  <script src="https://unpkg.com/kaboom@2000.2.9/dist/kaboom.js"></script>
  <style>
    body {
      margin: 0;
      background-color: transparent;
      font-family: 'Comic Sans MS', sans-serif;
    }
    canvas {
      display: block;
      margin: 20px auto;
      border: 4px solid #ffffff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>

<script>
kaboom({
  width: 700,
  height: 500,
  background: [10, 10, 20],
});

// Load assets
loadSprite("player", "player.png");
loadSprite("bullet", "bullet.png");
loadSprite("enemy", "enemy.png");

const SPEED = 320;
const BULLET_SPEED = 300;
const ENEMY_SPEED = 40;
const PLAYER_SCALE = 0.15;

let enemies = [];
let direction = 1;

// Wait for all sprites
onLoad(() => {
  // âœ… Add player AFTER sprite fully loads
  const player = add([
    sprite("player"),
    scale(PLAYER_SCALE),
    pos(width() / 2, height() - 64 * PLAYER_SCALE - 8), // assuming 64px sprite
    area(),
    "player",
  ]);

  // âœ… Player movement
  onKeyDown("left", () => {
    if (player.pos.x > 0) {
      player.move(-SPEED, 0);
    }
  });

  onKeyDown("right", () => {
    if (player.pos.x < width() - player.width * player.scale.x) {
      player.move(SPEED, 0);
    }
  });

  // âœ… Shoot bullet
  onKeyPress("space", () => {
    add([
      sprite("bullet"),
      scale(0.5),
      pos(player.pos.x + (player.width * player.scale.x) / 2 - 4, player.pos.y),
      move(UP, BULLET_SPEED),
      area(),
      "bullet",
    ]);
  });

  // ðŸ‘¾ Function to spawn enemy grid
  function spawnEnemies() {
    enemies = [];
    const ROWS = 3;
    const COLS = 6;
    const SPACING_X = 80;
    const SPACING_Y = 60;
    const START_X = 80;
    const START_Y = 50;

    for (let row = 0; row < ROWS; row++) {
      for (let col = 0; col < COLS; col++) {
        const e = add([
          sprite("enemy"),
          scale(0.35),
          pos(START_X + col * SPACING_X, START_Y + row * SPACING_Y),
          area(),
          "enemy",
        ]);
        enemies.push(e);
      }
    }
  }

  spawnEnemies();

  // ðŸ‘¾ Bounce enemies as a group
  onUpdate(() => {
    let bounce = false;
    for (const e of enemies) {
      if (!e.exists()) continue;
      e.move(direction * ENEMY_SPEED, 0);
      if (e.pos.x <= 0 || e.pos.x >= width() - 40) bounce = true;
    }
    if (bounce) {
      direction *= -1;
      for (const e of enemies) {
        if (e.exists()) e.pos.y += 20;
      }
    }

    // Respawn if all enemies destroyed
    const alive = enemies.filter(e => e.exists());
    if (alive.length === 0) {
      wait(1, () => {
        spawnEnemies();
      });
    }
  });

  // ðŸ’¥ Destroy on hit
  onCollide("bullet", "enemy", (b, e) => {
    destroy(b);
    destroy(e);
    addKaboom(e.pos);
  });
});
</script>

</body>
</html>
